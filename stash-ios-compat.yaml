# Stash iOS 兼容性增强版 - 俄勒冈桥接住宅 IP
# 重点：禁用 IPv6、优化 MTU、强制劫持 DNS

port: 7890
socks-port: 7891
mixed-port: 7893
allow-lan: false
mode: rule
log-level: info
# [优化 1] 强制关闭 IPv6，防止 iOS 优先使用 IPv6 导致连接挂起
ipv6: false

dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  # [优化 2] 强制 DNS 劫持，确保 Stash 接管所有解析
  listen: 0.0.0.0:53
  fake-ip-filter:
    - "*.lan"
    - "*.local"
  default-nameserver:
    - 223.5.5.5
  nameserver:
    - https://dns.google/dns-query
    - https://cloudflare-dns.com/dns-query

proxies:
  - name: "US-Oregon"
    type: ss
    server: 136.118.235.211
    port: 8388
    cipher: aes-256-gcm
    password: "7eBeHGS8rRpEVceYqW14pA=="
    # [优化 3] 桥梁节点开启 UDP，但住宅节点必须关闭
    udp: true

  - name: "US-Residential"
    type: socks5
    server: 86.109.86.37
    port: 12324
    username: "14a86a544796b"
    password: "e3c8d97c8a"
    udp: false 
    dialer-proxy: "US-Oregon"
    # [优化 4] 开启握手快速开始
    skip-cert-verify: true

proxy-groups:
  - name: Proxy
    type: select
    proxies:
      - "US-Residential"
      - "US-Oregon"
      - DIRECT

rules:
  - DOMAIN-SUFFIX,google.com,Proxy
  - DOMAIN-SUFFIX,youtube.com,Proxy
  - DOMAIN-SUFFIX,openai.com,Proxy
  - GEOIP,CN,DIRECT
  - MATCH,Proxy
